<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="李霄鹏的博客">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="李霄鹏的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李霄鹏的博客">






  <link rel="canonical" href="http://yoursite.com/page/3/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>李霄鹏的博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李霄鹏的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/08/浅析JAVA集合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/08/浅析JAVA集合/" itemprop="url">
                  浅析JAVA集合
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-08 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-08T00:00:00+08:00">2018-06-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:15" itemprop="dateModified" datetime="2018-12-25T09:58:15+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Set，无序、不可重复的集合。<br>List，有序、可重复的集合。<br>Queue，队列集合实现。<br>Map，具有映射关系的集合。<br>数组需要在初始化的时候指定长度，集合可以保存不确定数量的数据。<br>集合只能保存对象，数组可以保存基本数据类型和对象。</p>
</blockquote>
<h4 id="Collection-接口"><a href="#Collection-接口" class="headerlink" title="Collection 接口"></a>Collection 接口</h4><p><code>Collection</code>是<code>Set</code>，<code>List</code>，<code>Queue</code>的父接口。<br><code>add(E e)</code>，添加元素。<br><code>size()</code>方法，返回元素数。<br><code>toArray(T[] a)</code>方法，返回所有元素的数组。<br><code>remove(Object o)</code>方法，移出单个元素。<br><code>removeAll(Collection&lt;?&gt; c)</code>，移出指定元素。<br><code>retainAll(Collection&lt;?&gt; c)</code>，取交集。<br><code>isEmpty()</code>方法，size=0返回true。<br><code>iterator()</code>方法，该方法的返回值是<code>Iterator\&lt;E\&gt;</code>。<br>Iterator 适合访问<code>链式结构</code>，for循环适合访问<code>顺序结构</code>。<br>在LinkedList里，使用iterator较快；在ArrayList里，for循环较快。<br>foreach和iterator遍历集合时不能修改元素。<br>使用Collections的sync方法包装集合为线程安全的集合类。</p>
<h5 id="Set-接口"><a href="#Set-接口" class="headerlink" title="Set 接口"></a>Set 接口</h5><blockquote>
<p>Set集合不允许包含相同的元素,集合是无序的。<br>Set的实现原理是基于Map的。</p>
</blockquote>
<p><code>HashSet</code><br>线程不安全；<br>实现：建立一个Map，“键”就是我们要存入的对象，“值”则是一个常量；<br>允许包含值为null的元素，但最多只能有一个null元素；</p>
<p><code>LinkedHashSet</code><br>线程不安全；<br>也是一个hash表，但是同时维护了一个双链表来记录插入的顺序；<br>遍历该集合时候，LinkedHashSet将会以元素的添加顺序访问集合的元素；<br>插入性能略低于HashSet，但是遍历性能优于HashSet；</p>
<p><code>TreeSet</code><br>线程不安全；<br>基于Map来实现；<br>其底层结构为红黑树，性能不如HashSet；<br>遍历该集合时候，会以排序顺序方位集合元素。<br>素需要实现Comparable接口，或者集合中传入自定义比较器；</p>
<h5 id="List-接口"><a href="#List-接口" class="headerlink" title="List 接口"></a>List 接口</h5><blockquote>
<p>List集合允许包含相同的元素，集合是有序的。<br>每个元素都有其对应的顺序索引。</p>
</blockquote>
<p><code>ArrayList</code><br>线程不安全；<br>基于动态数组实现；<br>添加元素时会扩容数组，删除元素时不会缩小数组，trimToSize方法可以手动缩小；<br>内部数组默认大小为10，减少动态分配次数，可提高性能；</p>
<p><code>LinkedList</code><br>线程不安全；<br>基于双向链表实现；<br>插入和删除性能优于ArrayList，查询性能不如ArrayList；</p>
<p><code>Vector</code><br>线程安全；</p>
<h5 id="Queue-接口"><a href="#Queue-接口" class="headerlink" title="Queue 接口"></a>Queue 接口</h5><blockquote>
<p>FIFO容器，队列头部的元素保存时间最长，尾部反之；<br>Deque是Queue的子接口，为双端队列，LinkedList为Deque的实现；<br>add()方法，添加元素到尾部；<br>element()方法，获取头部元素，但不删除；<br>peek()方法，获取头部元素，但不删除；<br>poll()方法，获取头部元素，并删除；<br>remove()方法，删除头部元素；</p>
</blockquote>
<p><code>PriorityQueue</code><br>队列的顺序按照大小排序，不按照插入顺序。</p>
<h4 id="Map-接口"><a href="#Map-接口" class="headerlink" title="Map 接口"></a>Map 接口</h4><blockquote>
<p>Key和Value必须是引用类型；<br>Key不允许重复；</p>
</blockquote>
<p><code>HashMap</code><br>线程不安全；<br>Key和Value都可以是null；<br>实现基于数组和链表，key值hash取模值分布在数组上，entry形成链表；<br>扩容时，生成新的数组，并重新计算写入。<br>效率优于HashTable；</p>
<p><code>HashTable</code><br>线程安全；<br>Key和Value都不可以是null；</p>
<p><code>LinkedHashMap</code><br>线程不安全；<br>实现基于HashMap+LinkedList，LinkedList维护插入元素的先后顺序；<br>迭代顺序就是是插入顺序；<br>性能低于HashMap，需要维护顺序链表；</p>
<p><code>TreeMap</code><br>红黑树结构；<br>根据Key的大小进行排序；</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - URL拦截/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - URL拦截/" itemprop="url">
                  Nginx应用 - URL拦截
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">2018-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:26" itemprop="dateModified" datetime="2018-12-25T09:58:26+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/中间件/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><p>临时下线某个业务接口，不重新发布服务。</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line"></span><br><span class="line">#匹配请求url中包含指定字符的请求</span><br><span class="line">if ($request_uri ~* &quot;/bad_request&quot;) &#123;</span><br><span class="line">    return 200 &quot;error&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/浅识Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/浅识Nginx/" itemprop="url">
                  浅识Nginx
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">2018-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:14" itemprop="dateModified" datetime="2018-12-25T09:58:14+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/中间件/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>国籍：俄罗斯<br>语言：C语言<br>开源软件，BSD许可<br>跨平台支持Linux和Windows<br>可作为WEB服务器，负载均衡器，邮件代理服务器等</p>
</blockquote>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p><code>轻量级</code><br>占用更少的内存资源</p>
<p><code>高并发</code><br>异步非阻塞，epoll模，单机高并发</p>
<p><code>模块化</code><br>高度模块化的设计，便于扩展</p>
<p><code>超稳定</code><br>分为主进程，工作进程</p>
<h4 id="为什么高性能"><a href="#为什么高性能" class="headerlink" title="为什么高性能"></a>为什么高性能</h4><p><code>多进程模型</code><br>nginx默认以多进程的方式工作，一个master进程和多个worker进程，master进程主要用来管理worker进程。<br><code>异步非阻塞</code><br>在epoll支持下，采用异步非阻塞的方式来处理请求，从而实现高并发。</p>
<h4 id="进程模型"><a href="#进程模型" class="headerlink" title="进程模型"></a>进程模型</h4><blockquote>
<p>多进程模型<br>独立的工作进程，不共享资源，不加锁</p>
</blockquote>
<p><code>master进程</code><br>主进程，充当监控进程。<br>不需要处理网络事件，不负责业务的执行。<br>只负责管理worker进程。</p>
<p><code>worker进程</code><br>负责处理网络IO。<br>各worker进程竞争来自客户端的请求。<br>多cpu的情况下，设置woker进程的数量等于cpu的核数。<br>Nginx支持将某一个进程绑定在某一个核上。</p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><p><code>nginx</code> 启动</p>
<p><code>nginx -s stop</code> 关闭</p>
<p><code>ngixn -s relaod</code> 重载配置文件</p>
<p><code>nginx -t</code> 检查配置文件</p>
<p><code>nginx -v</code> 查看版本</p>
<h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><ol>
<li>worker_processes配置为CPU核数。</li>
<li>将worker process与指定cpu核绑定。</li>
<li>关闭访问日志，加快磁盘IO。</li>
<li>开启gzip，减少网络传输时间。</li>
<li>worker_rlimit_nofile，更改worker进程的最大打开文件数限制</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - 反向代理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - 反向代理/" itemprop="url">
                  Nginx应用 - 反向代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">2018-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:23" itemprop="dateModified" datetime="2018-12-25T09:58:23+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/中间件/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="为什么要用？"><a href="#为什么要用？" class="headerlink" title="为什么要用？"></a>为什么要用？</h4><ol>
<li>保护源服务的安全，相当于堡垒服务。</li>
<li>缓存静态资源，加速web请求。</li>
<li>灵活的服务中间件，实现服务热部署。</li>
</ol>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       7421;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass_header Server;</span><br><span class="line">        //保留Host请求头</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        //保留用户真实IP</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        //转发到7422端口</span><br><span class="line">        proxy_pass   http://127.0.0.1:7422;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Nginx应用 - 负载均衡/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Nginx应用 - 负载均衡/" itemprop="url">
                  Nginx应用 - 负载均衡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-01T00:00:00+08:00">2018-06-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:23" itemprop="dateModified" datetime="2018-12-25T09:58:23+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/中间件/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="负载策略"><a href="#负载策略" class="headerlink" title="负载策略"></a>负载策略</h4><p><code>轮循（默认）</code><br>根据Nginx配置文件中的顺序，依次把客户端的Web请求分发到不同的后端服务器上。</p>
<p><code>权重</code><br>配置Nginx把请求更多地分发到高配置的后端服务器上，把相对较少的请求分发到低配服务器。</p>
<p><code>IP Hash</code><br>同一客户端连续的Web请求都会被分发到同一服务器进行处理。</p>
<p><code>最少连接</code><br>请求会被转发到连接数最少的服务器上。</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><ul>
<li>轮循（默认）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass_header Server;</span><br><span class="line">        #保留Host请求头</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        #保留用户真实IP</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        #对应upstream的配置</span><br><span class="line">        proxy_pass   http://service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>权重</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    server 192.168.1.10 weight=1;</span><br><span class="line">    server 192.168.1.11 weight=2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>IP Hash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最少连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream service &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 192.168.1.7;</span><br><span class="line">    server 192.168.1.8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/Redis必知必会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/Redis必知必会/" itemprop="url">
                  Redis必知必会
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-02 00:00:00" itemprop="dateCreated datePublished" datetime="2018-05-02T00:00:00+08:00">2018-05-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:28" itemprop="dateModified" datetime="2018-12-25T09:58:28+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>开源KV数据库<br>由C语言编写<br>支持丰富的数据类型：string，set，list，sorted set，hash<br>数据操作具有原子性<br>支持数据持久化<br>可集群扩展 </p>
</blockquote>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li>速度快，整个数据库统统加载在内存当中进行操作；</li>
<li>支持保存多种数据结构；</li>
<li>操作都是原子性；</li>
<li>支持事务；</li>
<li>丰富的特性，支持有序集合，支持ttl，支持发布订阅；</li>
</ul>
<h4 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h4><p><code>string</code></p>
<ul>
<li>赋值：SET key value。如set hello world</li>
<li>取值：GET key。如get hello。返回是world</li>
<li>自增：INCR key。该key的值都会+1。该操作是原子操作。</li>
<li>自减：DECR key。该key的值都会-1。该操作是原子操作。</li>
</ul>
<p><code>list</code></p>
<ul>
<li>向头部插入：LPUSH key value1 value2…</li>
<li>向尾部插入：RPUSH key value1 value2…</li>
<li>从头部弹出：LPOP key。返回被弹出的元素值。</li>
<li>从尾部弹出：RPOP key。返回被弹出的元素值。</li>
<li>列表元素个数：LLEN key。key不存在返回0。</li>
<li>获取列表的子列表：LRANGE start end。</li>
</ul>
<p><code>set</code></p>
<ul>
<li>增加：SADD key value。</li>
<li>删除：SREM key value。</li>
<li>获取指定集合的所有元素：SMEMBERS key。</li>
<li>判断某个元素是否存在：SISMEMBER key value。</li>
<li>差集运算：SDIFF key1 key2…。对多个集合进行差集运算。</li>
<li>交集运算：SINNER key1 key2…。对多个集合进行交集运算。</li>
<li>并集运算：SUNION key1 key2…。对多个集合进行并集运算。</li>
<li>获取集合中元素个数：SCARD key。返回集合中元素的总个数。</li>
</ul>
<p><code>sorted set</code></p>
<ul>
<li>增加：ZADD key sorce1 value1 sorce2 value2…。</li>
<li>获取分数：ZSCORE key value。</li>
<li>获取分数范围内的元素：ZRANGEBYSCORE key min max </li>
<li>为某个元素增加分数：ZINCRBY key increment value。</li>
</ul>
<p><code>hash</code></p>
<ul>
<li>赋值：HSET key field value。</li>
<li>取值：HGET key field。</li>
<li>同一个key多个字段赋值：HMSET key field1 value1 field2 value2…。</li>
<li>同一个KEY多个字段取值：HMGET key field1 fields2…。</li>
<li>获取KEY的所有字段和所有值：HGETALL key。</li>
<li>字段是否存在：HEXISTS key field。存在返回1，不存在返回0。<br>当字段不存在时赋值：HSETNX key field value。如果key下面的字段field不存在，则建立field字段，且值为value。如果field字段存在，则不执行任何操作。这个命令的是原子操作。</li>
</ul>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p><code>RDB</code></p>
<blockquote>
<p>#在900秒之后，如果至少有1个key发生变化，则dump内存快照<br>save 900 1  </p>
</blockquote>
<ul>
<li>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</li>
<li>性能最大化。对于Redis的服务进程而言，在开始持久化时，它唯一需要做的只是fork出子进程，之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行IO操作了。</li>
<li>相比于AOF机制，如果数据集很大，RDB的启动效率会更高。</li>
<li>如果当数据集较大时，可能会导致整个服务器停止服务。</li>
</ul>
<p><code>AOF</code></p>
<blockquote>
<p>appendfsync always     #每次有数据修改发生时都会写入AOF文件。<br>appendfsync everysec  #每秒钟同步一次，该策略为AOF的缺省策略。<br>appendfsync no          #从不同步。高效但是数据不会被持久化。</p>
</blockquote>
<ul>
<li>AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</li>
<li>该机制可以带来更高的数据安全性。</li>
<li>Redis 4.0 推出RDB-AOF 混合持久化。</li>
</ul>
<h4 id="内存淘汰"><a href="#内存淘汰" class="headerlink" title="内存淘汰"></a>内存淘汰</h4><p>maxmemory参数，可以控制其最大可用内存大小（字节）。<br>超过maxmemory时，根据maxmemory-policy参数进行内存淘汰。</p>
<blockquote>
<p>volatile-lru     使用LRU算法删除一个键（只对设置了生存时间的键）<br>allkeys-lru       使用LRU算法删除一个键<br>volatile-random   随机删除一个键（只对设置了生存时间的键）<br>allkeys-random    随机删除一个键<br>volatile-ttl      删除生存时间最近的一个键<br>noeviction（默认配置）  不删除键，只返回错误</p>
</blockquote>
<h4 id="集群扩展"><a href="#集群扩展" class="headerlink" title="集群扩展"></a>集群扩展</h4><p><code>官方cluster方案</code><br>配置成主从结构，即一个master主节点，挂n个slave从节点。如果主节点失效，redis cluster会根据选举算法从slave节点中选择一个上升为master节点，整个集群继续对外提供服务。</p>
<p><code>twemproxy</code><br>twitter开源的代理分区方案。</p>
<p><code>codis</code><br>豌豆荚开源的代理分区方案。</p>
<p><code>客户端分片</code><br>分区的逻辑在客户端实现，由客户端自己选择请求到哪个节点。</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ul>
<li>keys指令会导致线程阻塞一段时间，线上服务会停顿，直到指令执行完毕，服务才能恢复。</li>
<li>使得过期时间分散一些，否则可能会出现短暂的卡顿现象。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/14/杂谈MySQL - 优化篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/14/杂谈MySQL - 优化篇/" itemprop="url">
                  杂谈MySQL - 优化篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-04-14 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-14T00:00:00+08:00">2018-04-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:20" itemprop="dateModified" datetime="2018-12-25T09:58:20+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p><code>show processlist</code></p>
<blockquote>
<p>显示哪些线程正在运行。<br>id       #ID标识，要kill一个语句的时候很有用<br>use      #当前连接用户<br>host     #显示这个连接从哪个ip的哪个端口上发出<br>db       #数据库名<br>command  #连接状态，一般是休眠（sleep），查询（query），连接（connect）<br>time     #连接持续时间，单位是秒<br>state    #显示当前sql语句的状态<br>info     #显示这个sql语句</p>
</blockquote>
</li>
<li><p><code>explain</code></p>
<blockquote>
<p>查询SQL的执行计划。<br>possible_keys       #字段上存在的索引<br>key                 #实际决定使用的索引<br>rows              #估算的找到所需的记录所需要读取的行数</p>
</blockquote>
</li>
<li><p><code>索引的优化</code></p>
<blockquote>
<p>LIKE查询，%不能在前，否则用不到索引。<br>列类型是字符串，查询时一定要给值加引号，否则索引失效。<br>确保GROUP BY和ORDER BY只有一个表中的列，这样MySQL才有可能使用索引。<br>is null将导致引擎放弃使用索引。<br>使用!=或&lt;&gt;操作符，否则引擎将放弃使用索引。<br>使用or 来连接条件，否则将导致引擎放弃使用索引。<br>in 和 not in ，会导致全表扫描。<br>where子句中对字段进行表达式操作，将导致引擎放弃使用索引。<br>where子句中对字段进行函数操作，将导致引擎放弃使用索引。</p>
</blockquote>
</li>
<li><p><code>LIMIT优化</code></p>
<blockquote>
<p>LIMIT偏移量大的时候，查询效率较低。<br>可以记录上次查询的最大ID，下次查询时直接根据该ID来查询。</p>
</blockquote>
</li>
<li><p><code>随机查询优化</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users </span><br><span class="line">WHERE </span><br><span class="line">id &gt;= </span><br><span class="line">((SELECT MAX(id) FROM users)-(SELECT MIN(id) FROM users)) </span><br><span class="line">* </span><br><span class="line">RAND() + (SELECT MIN(id) FROM users)</span><br><span class="line">LIMIT 10</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>count优化</code></p>
<blockquote>
<p>COUNT(1)和COUNT(*)性能相似<br>count(列名)性能差</p>
</blockquote>
</li>
<li><p><code>分区表</code></p>
<blockquote>
<p>分区表是一个独立的逻辑表，但是底层MySQL将其分成了多个物理子表。<br>执行查询时，优化器会根据分区定义，只需要查询数据所在分区。<br>所有分区都必须使用相同的存储引擎。<br>一个表最多只能有1024个分区。</p>
</blockquote>
</li>
<li><p><code>主从复制</code></p>
<blockquote>
<p>主库上把二进制日志，复制到从库，从库重放日志。<br>降低单个服务器的压力。<br>避免单点失败。</p>
</blockquote>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/03/MongoDB必知必会/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/03/MongoDB必知必会/" itemprop="url">
                  MongoDB必知必会
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-04-03 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-03T00:00:00+08:00">2018-04-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:22" itemprop="dateModified" datetime="2018-12-25T09:58:22+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>NoSQL文档数据库<br>由C++语言编写<br>支持分布式集群扩展</p>
</blockquote>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li>灵活，No Schema </li>
<li>解决海量数据存储，并有良好的查询性能</li>
<li>快速，热数据加载到内存，不用join</li>
<li>GEO支持，轻松解决附近位置查询场景</li>
</ul>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1）查看所有数据库（show dbs）</span><br><span class="line"></span><br><span class="line">2）创建新的数据库（use mydb）</span><br><span class="line"></span><br><span class="line">3）获取所有的集合（表）</span><br><span class="line"></span><br><span class="line">db.getCollectionNames();</span><br><span class="line"></span><br><span class="line">4）插入数据。</span><br><span class="line"></span><br><span class="line">db.collName.insert(&#123;name: &apos;Kane&apos;, gender: &apos;male&apos;&#125;);</span><br><span class="line"></span><br><span class="line">5）更新数据</span><br><span class="line"></span><br><span class="line">db.collName.update(&#123;_id: ObjectId(&apos;4df96d7fbc7a05156600e4f2&apos;)&#125;, &#123;$set: &#123;name: &apos;Kane&apos;, gender: &apos;male&apos;,weight:111&#125;&#125;);</span><br><span class="line"></span><br><span class="line">6）删除数据</span><br><span class="line"></span><br><span class="line">db.collName.remove(&#123;name: &apos;Kane&apos;&#125;);</span><br><span class="line"></span><br><span class="line">7）获取集合的文档（记录）数量。</span><br><span class="line"></span><br><span class="line">db.collName.count();</span><br><span class="line"></span><br><span class="line">8）获取集合的所有文档</span><br><span class="line"></span><br><span class="line">db.collName.find();</span><br><span class="line"></span><br><span class="line">9）获取集合中性别为male的文档</span><br><span class="line"></span><br><span class="line">db.collName.find(&#123;gender:&apos;male&apos;&#125;);</span><br><span class="line"></span><br><span class="line">10）获取集合中性别为男性且体重大于600的文档</span><br><span class="line"></span><br><span class="line">db.collName.find(&#123;gender:&apos;male&apos;,weight:&#123;$gt:600&#125;&#125;);</span><br><span class="line"></span><br><span class="line">11）展示名字和体重的所有文档</span><br><span class="line"></span><br><span class="line">db.collName.find(null,&#123;name:1,weight:1&#125;);</span><br><span class="line"></span><br><span class="line">12）找出性别为male，体重前2、3名的名字</span><br><span class="line"></span><br><span class="line">db.collName.find(&#123;gender: &apos;male&apos;&#125;, &#123;name: 1&#125;).sort(&#123;weight:-1&#125;).limit(2).skip(1);</span><br><span class="line"></span><br><span class="line">13）计算体重小于600的数量</span><br><span class="line"></span><br><span class="line">db.collName.count(&#123;weight:&#123;$lt:600&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="GEO支持"><a href="#GEO支持" class="headerlink" title="GEO支持"></a>GEO支持</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Point location = new Point(-73.99171, 40.738868);</span><br><span class="line">NearQuery query = NearQuery.near(location).maxDistance(new Distance(10, Metrics.MILES));</span><br><span class="line"></span><br><span class="line">GeoResults&lt;Restaurant&gt; = operations.geoNear(query, Restaurant.class);</span><br></pre></td></tr></table></figure>
<h4 id="Object-ID"><a href="#Object-ID" class="headerlink" title="Object ID"></a>Object ID</h4><p>ObjectId 是一个12字节 BSON 类型数据，有以下格式：</p>
<blockquote>
<p>前4个字节表示时间戳<br>接下来的3个字节是机器标识码<br>紧接的两个字节由进程id组成（PID）<br>最后三个字节是随机数。</p>
</blockquote>
<p>为了减少服务器端的开销，objectId是由客户端的驱动程序来生成的。</p>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><ul>
<li>类型</li>
</ul>
<p><code>单键索引</code><br>db.collection.createIndex({‘fieldName’:1});</p>
<p><code>唯一索引</code><br>db.books.ensureIndex({name:-1}, {unique:true});</p>
<p><code>复合索引</code><br>db.collection.createIndex({‘fieldName_one’:1,’fieldName_n..’:1});</p>
<p><code>TTL索引</code><br>db.collection.createIndex({‘dateTimeField’:1},{expireAfterSeconds:100(秒)});<br>在一段时间后会过期的索引，在索引过期后，相应的数据会被删除。</p>
<p><code>地理空间索引</code><br> db.collection.createIndex({w:”2d”})</p>
<ul>
<li>注意</li>
</ul>
<p><code>后台创建索引</code><br>db.values.createIndex({open: 1}, {background: true})<br>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引。<br><code>查看查询计划</code><br>db.books.find(query).explain();<br>分析查询耗时。</p>
<h4 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h4><p><code>模式</code><br>分为三种模式：主从，副本，sharding</p>
<p><code>副本模式</code><br>三类角色：主节点，副节点，仲裁节点</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/24/RabbitMQ - 消息幂等/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/RabbitMQ - 消息幂等/" itemprop="url">
                  RabbitMQ - 消息幂等
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-03-24 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-24T00:00:00+08:00">2018-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:27" itemprop="dateModified" datetime="2018-12-25T09:58:27+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/中间件/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是消息幂等"><a href="#什么是消息幂等" class="headerlink" title="什么是消息幂等"></a>什么是消息幂等</h4><p>publisher重复发送消息，导致业务重复执行。<br>consumer重复收到消息，导致业务重复执行。</p>
<h4 id="如何处理"><a href="#如何处理" class="headerlink" title="如何处理"></a>如何处理</h4><p><code>发送消息幂等</code><br>如果在publisher发送消息后，没有接收到ack，publisher会重发消息。<br>对每条消息，MQ系统内部必须生成一个inner-msg-id，作为去重和幂等的依据。</p>
<p><code>消费消息幂等</code><br>如果在consumer消费完消息后，ack没有成功的被broker接收，broker会重发消息。<br>对每条消息，业务消息体中，必须有一个biz-id，作为去重和幂等的依据</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/15/闲扯微服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hi@xiaopeng.li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李霄鹏的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/15/闲扯微服务/" itemprop="url">
                  闲扯微服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-02-15 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-15T00:00:00+08:00">2018-02-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-25 09:58:18" itemprop="dateModified" datetime="2018-12-25T09:58:18+08:00">2018-12-25</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/方法论/" itemprop="url" rel="index"><span itemprop="name">方法论</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>微服务，就是<code>协同工作</code>，<code>小而自制</code>的服务。<br>SOA架构强调的是异构系统之间的通信和解耦合。<br>微服务架构强调的是系统按业务边界做细粒度的拆分和部署。<br>Dubbo和Spring Cloud是框架和组件，SOA和微服务是架构思想。</p>
</blockquote>
<h4 id="单体架构痛点"><a href="#单体架构痛点" class="headerlink" title="单体架构痛点"></a>单体架构痛点</h4><p><code>项目过于臃肿</code><br>当大大小小的功能模块都集中在同一项目的时候，整个项目必然会变得臃肿，让开发者难以维护。</p>
<p><code>资源无法隔离</code><br>就像刚刚小灰的经历一样，整个单体系统的各个功能模块都依赖于同样的数据库、内存等资源，一旦某个功能模块对资源使用不当，整个系统都会被拖垮。</p>
<p><code>无法灵活扩展</code><br>当系统的访问量越来越大的时候，单体系统固然可以进行水平扩展，部署在多台机器上组成集群。但是这种扩展并非灵活的扩展。比如我们现在的性能瓶颈是支付模块，希望只针对支付模块做水平扩展，这一点在单体系统是做不到的。</p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p><code>技术异构</code><br>不必使用相同的编程语言和技术栈，不同的服务选用最适合自己的技术栈。</p>
<p><code>资源隔离</code><br>有效避免了服务之间争用数据库和缓存资源所带来的问题，实现了服务器资源（内存、CPU资源等）的有效隔离。</p>
<p><code>灵活扩展</code><br>微服务是以每一个独立组件（例如用户服务，商品服务）为单位进行独立部署，每个服务可以根据业务进行灵活扩展。</p>
<h4 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h4><p><code>增加开发复杂度</code><br>原有的进程内接口调用，变成RESTful接口调用。</p>
<p><code>增加测试复杂度</code><br>测试依赖其他服务，需要部署其他微服务支撑测试。</p>
<p><code>增加运维难度</code><br>原有的单个进程部署，现在需要多个微服务进程，和其他微服务支撑组件部署。</p>
<p><code>增加BUG排查难度</code><br>单个业务请求，贯穿多个微服务，需要跟踪多个微服务才能排查问题。</p>
<p><code>数据一致性</code><br>为了保证服务间的数据一致性，需要引入分布式事务和补偿机制。</p>
<h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><p><code>路由网关</code><br>提供动态路由,监控,弹性,安全等边缘服务的框架</p>
<p><code>服务注册中心</code><br>用于定位服务，以实现云端中间层服务发现和故障转移。</p>
<p><code>配置中心</code><br>可以把配置放到远程服务器，集中化管理集群配置。</p>
<p><code>断路器</code><br>通过熔断机制控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力。</p>
<h4 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h4><p><code>CAP原则</code><br>指的是在一个分布式系统中， Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。</p>
<p><code>BASE理论</code><br>BASE是Basically Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）三个短语的简写。</p>
<p><code>2PC两阶段提交</code><br>2PC顾名思义分为两个阶段，其实施思路可概括为：<br>（1）投票阶段（voting phase）：参与者将操作结果通知协调者；<br>（2）提交阶段（commit phase）：收到参与者的通知后，协调者再向参与者发出通知，根据反馈情况决定各参与者是否要提交还是回滚；<br> 实现复杂，牺牲了可用性，对性能影响较大，不适合高并发高性能场景</p>
<p><code>TCC补偿事务</code><br>Try 阶段主要是对业务系统做检测及资源预留。<br>Confirm 阶段主要是对业务系统做确认提交，Try阶段执行成功并开始执行 Confirm阶段时，默认 Confirm阶段是不会出错的。即：只要Try成功，Confirm一定成功。<br>Cancel 阶段主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放。</p>
<p><code>本地消息表</code><br>消息生产方，需要额外建一个消息表，并记录消息发送状态。消息表和业务数据要在一个事务里提交，也就是说他们要在一个数据库里面。然后消息会经过MQ发送到消息的消费方。如果消息发送失败，会进行重试发送。<br>遵循BASE理论，采用的是最终一致性。</p>
<p><code>事务消息</code><br>有一些第三方的MQ是支持事务消息的，比如RocketMQ，他们支持事务消息的方式也是类似于采用的二阶段提交。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">hi@xiaopeng.li</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hi@xiaopeng.li</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.3.0</div>




        








  <div style="display: none;">
	<script src="https://s23.cnzz.com/z_stat.php?id=1275427549&web_id=1275427549" language="JavaScript"></script>
  </div>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
